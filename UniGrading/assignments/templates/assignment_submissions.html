{% extends 'base.html' %}
{% load humanize %}
{% block title %}Submissions – {{ assignment.title }}{% endblock %}

{% block content %}
<div class="container mt-5">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      {% for name, url in breadcrumbs %}
        <li class="breadcrumb-item"><a href="{{ url }}">{{ name }}</a></li>
      {% endfor %}
      <li class="breadcrumb-item active" aria-current="page">Submissions</li>
    </ol>
  </nav>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Submissions — {{ assignment.title }}</h3>
    <a href="{% url 'assignments:assignment_detail' assignment.pk %}" class="btn btn-outline-secondary">
      ← Back to Assignment
    </a>
  </div>

  {% if submissions %}
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="thead-light">
          <tr>
            <th>Student</th>
            <th>Submitted</th>
            <th>Status</th>
            <th>Grade</th>
            <th>Comments</th>
            <th style="width: 190px;">Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for s in submissions %}
          <tr>
            <td>
              {{ s.student.get_full_name|default:s.student.email }}
            </td>
            <td title="{{ s.submitted_at }}">
              {{ s.submitted_at|date:"M d, Y H:i" }} ({{ s.submitted_at|naturaltime }})
            </td>
            <td>
              {% if s.autograde_status %}
                <span class="badge badge-{{ s.autograde_status|yesno:'info,warning,success,danger' }}">
                  {{ s.autograde_status }}
                </span>
              {% else %}
                <span class="badge badge-secondary">n/a</span>
              {% endif %}
            </td>
            <td>
              {% if s.grade_pct is not None %}
                <strong>{{ s.grade_pct|floatformat:2 }}%</strong>
              {% else %}
                <span class="text-muted">Pending</span>
              {% endif %}
            </td>
            <td>
              {% if s.ai_feedback %}
                {{ s.ai_feedback|truncatechars:60 }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
            <td class="text-nowrap">
              <a class="btn btn-sm btn-outline-primary"
                 href="{% url 'assignments:assignment_submission_detail' s.pk %}">
                View
              </a>
              <a class="btn btn-sm btn-outline-info"
                 href="{% url 'assignments:preview_submission_file' s.pk %}" target="_blank" rel="noopener">
                Preview
              </a>
              <a class="btn btn-sm btn-outline-success"
                 href="{% url 'assignments:download_submission_file' s.pk %}">
                Download
              </a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info mb-0">
      No submissions yet.
    </div>
  {% endif %}
</div>
{% endblock %}
